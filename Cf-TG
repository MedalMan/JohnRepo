import boto3
from datetime import datetime, timedelta
from dateutil import tz

def lambda_handler(event, context):
    client = boto3.client('elbv2')  # Create ELB client

    # List of Elastic Load Balancers to check
    elbs = ['arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/MyELB/abcdefg']

    expiration_threshold_days = 30  # Set your threshold

    for elb in elbs:
        response = client.describe_load_balancers(Names=[elb])
        lb = response['LoadBalancers'][0]

        for cert in lb['SslPolicies'][0]['SslServerCertificate']['ServerCertificateArn']:
            response = client.describe_server_certificates(ServerCertificateName=cert)
            certificate = response['ServerCertificates'][0]

            expiration_date = certificate['Expiration']
            now = datetime.now(tz.tzutc())
            threshold_date = now + timedelta(days=expiration_threshold_days)

            if expiration_date < threshold_date:
                # Send alert (you can use SNS or other methods)
                print(f"Certificate {cert} for ELB {elb} is about to expire on {expiration_date}")

# Add code to send alerts (e.g., using SNS) as needed
